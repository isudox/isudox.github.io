---
title: "Time, Clocks, and the Ordering of Events in a Distributed System 论文"
date: 2021-04-19T14:28:46+08:00
tags: 
  - 分布式系统
---

> 摘要：论文研究在分布式系统中，事件发生先后顺序的概念，并展示了如何定义事件之间的偏序。论文给出了一种用于同步逻辑时钟系统的分布式算法，该逻辑时钟可用于对事件做全序排序。其中，全序是描述解决同步问题的一种方法。该算法专门用于同步物理时钟。

# 引入

时间的概念是我们思考的基础。而它源于事件发生顺序这一更基础的概念。当一件事情发生在时钟显示 3:15 且未到 3:16 之前，那我们就说它发生在 3:15。对事件的时间顺序概念遍布于我们对系统的思考。例如，我们在机票预定系统中发起的预定请求，如果它发生在航班订满之前，那就应该被接受。但在分布式系统中，我们会发现事件的时间顺序概念需要被重新审视。

分布式系统由空间上彼此分开的一组独立进程组成，进程间通过交换消息进行通信。计算机互联的网络，比如 ARPANET（阿帕网）就是一个分布式系统。一台集成了 CPU、内存、I/O 通道等独立处理单元的计算机也可以被视为分布式系统。如果相对于单进程中事件之间的时间，消息传输的延时大到不可忽略时，系统就是分布式的。

本文主要关注空间分离的计算机系统。但我们的诸多观点可以得到更普遍的应用。特别的，由于不可预知的事件发生顺序，单机上多进程系统也涉及到类似分布式系统中的问题。

在分布式系统中，有时候无法确定两个事件哪个先发生。「之前发生」（happened before）只是系统中事件之间的偏序（Partial Ordering）。我们发现，由于人们没有充分认知到这个事实和它的含义，导致问题的出现。

在本论文中，我们讨论由「之前发生」所定义的偏序，提供一个分布式算法来将其扩展成对所有事件一致的全序（Total Ordering）。该算法提供了实现分布式系统的有效途径。我们用解决同步问题的一个简单方法，来说明该算法的使用。然而，如果通过该算法获取的事件顺序和用户感知的不同时，会导致异常行为。这可以通过引入真实的物理时钟来规避。我们描述了一种用于同步这些时钟的简单方法，并推导了时钟同步漂移的误差上限。 

# 偏序｜The Partial Ordering

大部分人会认为，如果事件 A 发生的时间比事件 B 发生时间早，则事件 A 是在事件 B 「之前发生」。他们根据物理时间的理论来证明该定义的正确性。然而，如果系统要正确地满足一项规约，则该规约必须根据系统可观测的事件给出。如果规约是基于物理时间，那么系统必须要包含真实的时钟。即使包含了真实时钟，仍然存在时钟非完美精确和保持精准物理时间的问题。因此我们不使用物理时钟来定义「之前发生」这一关系。

我们从更精准的定义系统开始。假设系统由一组进程组成。每个进程包含了一系列事件。根据应用程序的不同，事件可以是执行子程序，或者是执行单个机器指令。我们假设一个进程中的事件组成一个序列，当`a`在`b`「之前发生」，则事件序列里`a`就在`b`之前。换个说法，进程是一组全序事件的集合。这似乎也是通常意义上进程的含义。我们也可以把上述定义扩展到子进程，但没必要这么做。

假设发送或接受消息是进程中的事件。我们可以用符号`->`表示「之前发生」，如下所示：

**定义**。系统中一组事件之间的`->`关系，是满足以下三个条件的最小关系：

1. 如果`a`和`b`是同一进程中的事件，且`a`在`b`之前，则`a -> b`；
2. 如果`a`是一个进程的消息发送事件，`b`是另一进程的消息接收事件，则`a -> b`；
3. 如果`a -> b`且`b -> c`，则`a -> c`。如果两个独立事件满足`a !-> b`且`b !-> a`，则二者并行（concurrent）；

假设任意事件`a`，`a !-> a`（事件在自身之前发生的系统，并不存在物理意义）。这表明`->`表示的是，系统中事件之间非自反性的偏序关系。




# 逻辑时钟｜Logical Clocks

# 全局事件顺序｜Ordering the Events Totally

# 反常行为｜Anomalous Behavior

# 结论

# 附

--------

[论文链接](https://lamport.azurewebsites.net/pubs/time-clocks.pdf)